create or replace TRIGGER "TRG_INC_UPD_DLT_AD_TCIIBE_LOG" BEFORE  INSERT OR UPDATE OR DELETE  ON TCIIBE FOR EACH ROW

DECLARE 

	P_ACAO      VARCHAR2(100); 
	P_CHAVEPK   VARCHAR(400);
    P_CODUSU     VARCHAR2(100);


BEGIN

    P_CHAVEPK := ''||:NEW.CODBEM||'';
    P_CODUSU := TSIUSU_LOG_PKG.V_CODUSULOG;


  IF INSERTING THEN  

	STP_GRAVAR_LOG_AD_TCIIBELOG(
	'TRG_INC_UPD_DLT_AD_TCIIBE'
	,P_CHAVEPK
	,'INSERT'
	,:NEW.NUNOTA
	,:NEW.SEQUENCIA
	,0
	,:NEW.CODPROD
	,0
	,:NEW.CODBEM
	,NULL
	,P_CODUSU
	);

  RETURN;

  ELSIF DELETING THEN 

	P_CHAVEPK := :OLD.CODBEM;

	STP_GRAVAR_LOG_AD_TCIIBELOG(
	'TRG_INC_UPD_DLT_AD_TCIIBE'
	,P_CHAVEPK
	,'DELETE'
	,:OLD.NUNOTA
	,:OLD.SEQUENCIA
	,0
	,:OLD.CODPROD
	,0
	,:OLD.CODBEM
	,NULL
	,P_CODUSU
	);

    RETURN;

  ELSIF UPDATING THEN 

	STP_GRAVAR_LOG_AD_TCIIBELOG(
	'TRG_INC_UPD_DLT_AD_TCIIBE'
	,P_CHAVEPK
	,'UPDATE'
	,:NEW.NUNOTA
	,:NEW.SEQUENCIA
	,:OLD.SEQUENCIA
	,:NEW.CODPROD
	,:OLD.CODPROD
	,:NEW.CODBEM
	,:OLD.CODBEM
	,P_CODUSU
	);		

    RETURN;
  END IF;

END;