CREATE OR REPLACE TRIGGER TRG_INC_UPD_DLT_AD_TCIIBE
BEFORE  INSERT OR UPDATE OR DELETE  ON TCIIBE FOR EACH ROW

DECLARE 

	P_ACAO      VARCHAR2(10); 
	P_CHAVEPK   VARCHAR(400);
    P_CODUSU    INT;


BEGIN

    P_CHAVEPK := ''||:NEW.CODBEM||'';
    P_CODUSU := TSIUSU_LOG_PKG.V_CODUSULOG;
    
  IF INSERTING THEN  

	STP_GRAVAR_LOG_AD_TCIIBELOG(
	'TRG_INC_UPD_DLT_AD_TCIIBE'
	,P_CHAVEPK
	,'INSERT'
	,:NEW.NUNOTA
	,:NEW.SEQUENCIA
	,' '
	,:NEW.CODPROD
	,' '
	,:NEW.CODBEM
	,' '
	,P_CODUSU
	);

  RETURN;

  ELSIF DELETING THEN 

	P_CHAVEPK := :OLD.CODBEM;
	
	STP_GRAVAR_LOG_AD_TCIIBELOG(
	'TRG_INC_UPD_DLT_AD_TCIIBE'
	,P_CHAVEPK
	,'DELETE'
	,:OLD.NUNOTA
	,:OLD.SEQUENCIA
	,' '
	,:OLD.CODPROD
	,' '
	,:OLD.CODBEM
	,' '
	,P_CODUSU
	);

    RETURN;

  ELSIF UPDATING THEN 
		
	STP_GRAVAR_LOG_AD_TCIIBELOG(
	'TRG_INC_UPD_DLT_AD_TCIIBE'
	,P_CHAVEPK
	,'UPDATE'
	,:NEW.NUNOTA
	,:NEW.SEQUENCIA
	,:OLD.SEQUENCIA
	,:NEW.CODPROD
	,:OLD.CODPROD
	,:NEW.CODBEM
	,:OLD.CODBEM
	,P_CODUSU
	);		

    RETURN;
  END IF;

END;